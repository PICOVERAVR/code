CC = gcc
STANDARD = -std=gnu11 # default anyways, not necessary
CFLAGS = -Wall -Wextra $(STANDARD)
DFLAGS = $(CFLAGS) $(STANDARD) -g # generate symbol information

SRC := $(filter-out $(exclude), $(wildcard *.c)) # grab anything with a .c ending

USER_FLAGS := $(vars)
UNAME := $(shell uname -sm)

debug: pre
	@$(CC) $(SRC) $(DFLAGS) -Og -o 'db.out'
	@echo "Debug build completed."

# small as in number of instructions executed, not total binary size
small: pre
	@$(CC) $(SRC) $(CFLAGS) -static -o 'small.out'
	@echo "Small build completed."

fast: pre
	@$(CC) $(SRC) $(CFLAGS) -O3 -march=native -o 'prod.out' 
	@echo "Optimized build completed."

pre:
	@echo "Building on $(UNAME), user params: $(USER_FLAGS)"

clean:
	@rm -f *.out
	@rm -f *.s *.o
	
	@rm -rf *.out.dSYM # get rid of debug info, macOS specific
	@rm -f *.gch
